# 计算机网络(四)——网络层：控制平面

## 一、概述

控制平面作为一种网络范围的逻辑，不仅控制从源主机到目的主机的端到端路径间的路由器如何转发数据报，还控制网络层组件和服务如何配置和管理。回顾数据平面中计算、维护、安装转发表和流表的两种方法：**每路由器控制**和**逻辑集中式控制**。在逻辑集中式控制中，逻辑式集中控制器与每台路由器中的一个控制代理(CA)进行交互，以配置和管理该路由器的转发表，**SDN**(Software Defined Network)就是一种逻辑集中式控制器。



## 二、路由选择算法

路由选择算法将从发送方到接收方的过程中确定一条通过路由器网络的好的路径，即具有最低开销的路径，路由选择算法有以下几种分类方式和相关算法

### 1.集中式or分散式

#### 集中式路由算法

用完整的、全局性的网络知识计算出从源到目的地之间的最低开销路径，即该算法以所有节点之间的连通性以及所有链路的开销为输入。具有全局状态信息的算法通常被称为**链路状态算法**，如LS(Link State)算法

#### 分散式路由算法

路由器以迭代、分布式的方式计算出最低开销路径，节点并没有所有网络链路开销的完整信息，仅有与其直接相连链路的开销知识即可开始工作。然后通过迭代计算过程以及与相邻结点的信息交换，一个节点逐渐计算出到达某目的节点或一组目的节点的最低开销路径。分散式路由算法有如**距离向量(Distance-Vector,DV)算法**等



### 2、静态or动态

#### 静态路由算法

路由随时间的变化非常缓慢，通常是人工进行调整的

#### 动态路由算法

随着网络流量负载或拓扑发生变化而改变路由选择路径



### 3、负载敏感or负载迟钝

#### 负载敏感算法

链路开销会动态地变化以反映出底层链路的当前拥塞水平。如果当前拥塞的一条链路与高开销相关联，则路由选择算法趋向于绕开该拥塞链路来选择路由，如早期的ARPAnet算法

#### 负载迟钝算法

当今的因特网路由选择算法都是负载迟钝的，因为某条链路的开销不明确地反映其当前地拥塞水平



## 三、自治系统内部的路由选择——OSPF

若将网络只看做一个互联路由器地集合，那么将会碰到2个问题：

**1.规模**。当路由器数目变得庞大，涉及路由选的信息地通信、计算、存储地开销将高得不可实现

**2.管理自治**。因特网是ISP地网络，其中每个ISP都有自己地路由器网络。ISP通常希望能按照自己的意愿运行路由器。



### OSPF(开放最短路优先)

上述的两个问题都可以通过将路由器组织进自治系统(Autonomous System,AS)来解决，每个AS由一组处在相同管理控制下地路由器组成，通常在一个ISP中地路由器以及互联它们的链路组成一个AS，某些ISP将它们的网络划分为多个AS。在一个自治系统内运行的路由选择算法叫做**自治系统内部路由选择协议**。

OSPF路由选择协议被广泛用于因特网的AS内部路由选择，OSPF是一种链路状态协议，它使用洪泛链路状态信息和Dijkstra最低开销路径算法(集中式路由选择算法)。使用OSPF，一台路由器构建了一幅关于整个自治系统的完整拓扑图。

使用OSPF时，路由器向自治系统内所有其他路由器广播路由选择信息，每当该路由器对应的一条链路状态发生变化时，路由器就会广播链路状态信息。不过，即使链路未发生变化，它也要周期性地广播链路状态。



### OSPF的优点

#### 安全

仅有受信任的路由器能参与一个AS内的OSPF协议，因此可防止恶意入侵者

#### 多条相同开销的路径

当到达某目的地有多条相同开销的路径，OSPF允许使用多条路径，达到负载流量的效果

#### 对单播与多播路由选择的综合支持

#### 支持在单个AS中的层次结构



## 四、ISP之间的路由选择：BGP

当分组跨越多个AS进行路由时，需要一个**自治系统间路由选择协议**(inter-autonomous system routing protocol)。因为AS键路由选择协议涉及多个AS之间的协调，所以AS通信必须运行相同AS间路由选择协议。在因特网中，所有的AS运行相同的AS间路由选择协议，称为**边界网关协议(Border Gateway Protocol)**。



### BGP的作用

在BGP中，分组并不是路由到一个特定的目的地址，而是路由到CIDR化的前缀，每个前缀标识一个子网或一个子网的集合，如138.16.68/22，对于这个例子来说包括1024个IP地址。因此，一台路由表将具有形式为(x,I)的表项，x是一个前缀，如上述的如138.16.68/22，I是该路由器的接口之一的接口号。

BGP为每台路由器提供了一种完成以下任务的手段：

#### **1.从邻居AS间获得前缀的可达性信息**

#### **2.确定到该前缀的“最好的”路由**

**热土豆路由选择算法**

一个路由器尽可能快地将分组送出其AS，而不担心其AS外部到目的地地余下部分地开销

**路由器选择算法**

BGP实践中使用的路由选择算法





### IP任播

BGP还常被用于实现IP任播服务，该服务通常用于DNS中。任播又被称为泛播、选播、联播，是一种网络寻址和路由的策略，使得资料可以根据路由拓朴来决定送到“最近”或“最好”的目的地。



## 五、SDN控制平面

SDN控制平面能**控制**分组在网络的SDN使能设备中**转发的网络范围逻辑**，以及这些设备和它们的服务的配置与管理。SDN体系结构具有4个关键特征：

**1.基于流的转发**

SDN控制平面的工作是计算、管理和安装所有网络发现中的流表项

**2.数据平面与控制平面分离**

**3.网络控制功能**

控制平面自身由2个组件构成：一个SDN控制器以及若干网络控制应用程序。

**4.可编程的网络**



### SDN控制器

SDN控制平面组成之一，控制器的功能可大体组织为3个层次：

#### 通信层：控制器和受控网络设备之间的通信

控制器要控制远程SDN使能的路由器、主机或其他设备，需要一个协议来传送控制器与这些设备之间的信息。此外设备必须能够向控制器传递本地观察到的事件。

#### 网络范围状态管理层

由SDN控制平面做出的最终控制决定，将要求控制器具有有关网络的主机、链路、交换机以及其他SDN控制设备的最新状态信息。

#### 对于网络控制应用程序层的接口

SDN控制器通过“北项”接口与**网络控制应用程序**交互



### **网络控制应用程序**

SDN控制平面组成之一，网络控制应用程序提供了不同类型地API，如路由选择、接入控制和负载均衡等



### OpenFlow协议

**OpenFlow**，一种网络通信协议，属于数据链路层，能够控制网上交换器或路由器的转发平面（forwarding plane），借此改变网络数据包所走的网络路径。OpenFlow运行在SDN控制器和SDN控制地交换机或其他实现OpenFlow API地设备之间。OpenFlow协议运行在TCP之上，使用6653地默认端口号。

**从控制器到受控交换机流动的重要报文如下：**

**配置**

报文允许控制器查询并设置交换机的配置参数

**修改状态**

增加/删除或修改交换机流表中的表项，并且设置交换机端口特性

**发送分组**

从特定端口发出一个特定的报文



**从受控交换机到控制器流动的重要报文如下：**

**流删除**

通知控制器已删除一个流表项

**端口状态**

通知端口状态的变化

**分组入**

用于将分组发送给控制器



## 六、ICMP：因特网控制报文协议

ICMP被主机和路由器用来彼此沟通网络层的信息。ICMP最典型的用途是差错报告，如当运行一个HTTP会话时，也许会遇到诸如“目的网络不可达”置类的错误报文。ICMP使用IP的基本支持，就像它是一个更高级别的协议，但是，ICMP实际上是IP的一个组成部分，必须由每个IP模块实现。