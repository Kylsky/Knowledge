# 计算机网络(五)——链路层和局域网

## 一、概述

### 链路层提供的服务

1.**成帧**。链路层协议将数据报用链路层帧封装起来。一个帧由一个数据字段和若干个首部组成。

2.**链路接入**。媒体访问控制协议(MAC协议)规定了帧在链路上传输的规则。

3.**可靠交付**。链路层可靠服务通常用于易产生高差错率的链路，通过确认和重传机制取地可靠交付服务。

4.**差错检测和纠正**。链路层的差错检测通常用硬件实现。



### 链路层在何处实现

路由器中，链路层实现在路由器的线路卡中。主机结构中，链路层主体部分位于网络适配器中。





## 二、差错检测和纠正技术

链路层在传输数据中检验差错有三种技术，分别如下：

### 奇偶校验

使用单个奇偶校验位。在偶校验方案中，发送方在数据后加上一个附加的比特，使得n+1个比特中1的总数总是偶数。对于奇校验，发送方在数据后加上一个附加的比特，使得n+1个比特Hon过的总数总是奇数。但是上述的校验可能会导致未检查出的差错，如偶较严重出现了偶数个比特差错，则校验时无法检测出差错。

因此可以考虑使用二维奇偶校验，将n个比特划分为i行j列，当比特出错时，改变的行和列的校验值都会出现错误，因此接收方不仅可以检测到出现的单个比特差错的实时，并且可以纠正错误。

奇偶校验属于接收方检测，接收方检测和纠正差错的能力叫**前向纠错**。这些技术通常用与如音频CD这样的存储和回访设备。



### 检验和方法

与因特网检验和类似。



### 循环冗余检测(CRC)

计算机网络广泛应用的差错检测技术。CRC编码也称为多项式编码，因为该编码能够将要发送的比特串看作系数是0和1的一个多项式。CRC编码操作如下：考虑d比特的数据D，发送节点要将它发送给接收节点，发送方和接收方协商生成一个r+1的比特模式，称为生成多项式，表示为G，并要求G的最高有效位为1。对于一个给定的数据段D，发送方选择r个附加比特R，并将它们附加到D上，使得得到的d+r个比特能被G整除。



## 三、交换局域网

### 链路层寻址

主机和路由器都有链路层地址，即MAC地址。事实上，并不是主机或路由器具有MAC地址，而是它们的适配器具有链路层地址。MAC地址长度为6个字节，因此有2^48个可能的MAC地址，MAC地址由IEEE管理，当一个公司要生产适配器时，IEEE将前n位设为固定地址，后48-n位给公司自由配置。当某适配器向目的适配器发送一个帧时，发送适配器将目的适配器的MAC地址插入到帧中，并将帧发送到局域网上。当适配器接受当一个帧时，将检查该帧中的目的MAC地址是否与它自己的MAC地址相同。若匹配，则适配器提取出封装的数据报并将数据报向上层传递。



### 地址解析协议(ARP)

因为存在网络层地址(IP)和链路层地址(MAC)，所以需要在它们之间进行转换，这是地址解析协议(Address Resolution Protocol，ARP)的任务。主机中的ARP模块将取地在相同局域网上的任何IP地址作为输入，然后返回响应的MAC地址，ARP只为在同一个子网上的主机和路由器接口解析IP地址。

每台主机或路由器在内存中都有一个ARP表，包含**IP地址、MAC地址、TTL**三个字段。表示IP地址与MAC地址的映射关系及存在时限。当主机发送数据报，发送主机需要获得给定IP地址的主机的MAC地址。如果发送方ARP表中存在映射，则直接发送。若ARP表中不存在映射，则需要如下操作：

1.源主机向适配器构造一个ARP查询分组，包含发送和接收方的IP地址及MAC地址这4个字段，

2.指示适配器将这个ARP查询分组广播出去

3.接收到查询分组的子网中的所有主机的适配器检查自己的IP地址是否与ARP分组的目的IP地址相匹配

4.与目的IP地址匹配的主机发送回一个带有所希望映射的响应ARP分组，字段与查询分组相同

5.源主机接收到ARP响应分组，获取目的主机的MAC地址



### 发送数据报到子网外

路由器的每一个接口都有一个ARP模块和一个适配器，当目的主机并不位于子网中，那么源主机会将ARP查询分组广播到路由器中，路由器通过ARP在其他接口的子网或外网中获取目的主机的ARP地址并保存在ARP表中，并向源主机发送ARP响应分组。



### 以太网

以太网几乎占领着现有的有线局域网市场。

#### 以太网帧结构

**前同步码**

8字节。前7字节每个字节都固定为10101010，用于唤醒接收适配器。最后一个字节为10101011，用于提醒适配器注意接收数据。

**目的地址**

包含目的适配器的MAC地址

**源地址**

包含源适配器的MAC地址

**数据字段**

46-1500字节。数据字段承载了IP数据报

**类型**

上层网络层使用的协议类型，如IP

**CRC**

4字节。用于检验帧中是否存在差错



## 四、结语

有关计算机网络的几篇文章是从《计算机网络——自顶向下方法》中做的一些归纳及我的理解，只记录了从应用层到链路层几个章节的我认为比较重要或需要了解的知识，还有许多内容没有记录以及深入地挖掘，希望今后能有时间继续补充。







