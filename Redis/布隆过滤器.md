# 布隆过滤器

布隆过滤器主要用于解决Redis的缓存穿透问题，以下简称BF。

## 一、布隆过滤器的工作流程

1.将数据库中需要使用缓存的所有元素（数据）按映射函数存放到redis中的一个bitmap的多个位上并置1

2.不同元素（数据）通过映射函数可能会有相同的在bitmap的位，即产生交集

3.在客户端get时将搜索条件根据映射函数映射后与bitmap上的位作比较。

4.**若位都是1**，则说明可能有该数据，因为位可能是不同元素产生的交集，如1-4-7和2-4-8的交集是4，搜索时查到了148，虽然位上都是1，但是该元素其实并不存在，仍旧会穿透并被放行到关系型数据库中

5.**若位存在0**，则说明搜索的数据不存在

6.当请求穿透到关系型数据库中，则redis client增加当前搜索的key，并标记value为空

7.若数据库中增加了需要被缓存的元素，则一定要完成元素对bloom过滤器的添加



## 二、布隆过滤器不支持删除

布隆过滤器可以支持 add 和 isExist 操作，但是不支持delete 操作因为一旦删除其中一个值例如 “tencent” 而将其置位 0，那么下次判断另一个bitmap产生交集的值例如 “baidu” 是否存在的话，可能会直接返回 false，但而实际上你并没有删除"baidu"。

如何解决这个问题，答案是计数删除。但是计数删除需要存储一个数值，而不是原先的 bit 位，会增大占用的内存大小。这样的话，增加一个值就是将对应索引槽上存储的值加一，删除则是减一，判断是否存在则是看值是否大于0。



## 三、如何选择哈希函数个数和布隆过滤器长度

参考：https://zhuanlan.zhihu.com/p/43263751